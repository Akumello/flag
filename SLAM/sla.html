<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLA Tracker - Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            /* Base Colors - Original GSA Palette */
            --color-gray-light: #F2F2F2;
            --color-gray-medium: #BBBDBF;
            --color-gray-dark: #424143;
            --color-blue-dark: #004F87;
            --color-orange: #CF4817;
            --color-green: #286D3B;
            --color-red-dark: #522032;
            --color-blue-light: #1B7CAC;
            
            /* Light Mode Semantic Colors */
            --color-background: var(--color-gray-light);
            --color-surface: #FFFFFF;
            --color-border: var(--color-gray-medium);
            
            --color-text-primary: var(--color-gray-dark);
            --color-text-secondary: #6B6B6B;
            --color-text-muted: #8E8E8E;
            
            --color-primary: var(--color-blue-dark);
            --color-primary-hover: var(--color-blue-light);
            
            --color-status-success: var(--color-green);
            --color-status-success-bg: #E6F4EA;
            --color-status-warning: var(--color-orange);
            --color-status-warning-bg: #FEF0E5;
            --color-status-error: var(--color-red-dark);
            --color-status-error-bg: #F9E6EB;
            --color-status-info: var(--color-blue-light);
            --color-status-info-bg: #E5F3F9;
            
            --color-priority-critical: var(--color-red-dark);
            --color-priority-critical-bg: var(--color-status-error-bg);
            --color-priority-high: var(--color-orange);
            --color-priority-high-bg: var(--color-status-warning-bg);
            --color-priority-medium: var(--color-blue-light);
            --color-priority-medium-bg: var(--color-status-info-bg);
            --color-priority-low: var(--color-green);
            --color-priority-low-bg: var(--color-status-success-bg);
            
            --font-family: Calibri, sans-serif;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            /* Dark Mode Semantic Colors */
            --color-background: #1a1a1a;
            --color-surface: #2d2d2d;
            --color-border: #4a4a4a;
            
            --color-text-primary: #e5e5e5;
            --color-text-secondary: #b8b8b8;
            --color-text-muted: #999999;
            
            --color-primary: #3a7bc8;
            --color-primary-hover: #5c94d4;
            
            /* Slightly adjusted colors for better contrast on dark */
            --color-status-success: #4caf50;
            --color-status-success-bg: #1b4d1f;
            --color-status-warning: #ff9800;
            --color-status-warning-bg: #4d2c00;
            --color-status-error: #f44336;
            --color-status-error-bg: #4d1319;
            --color-status-info: #2196f3;
            --color-status-info-bg: #0d2c4d;
            
            --color-priority-critical: #f44336;
            --color-priority-critical-bg: var(--color-status-error-bg);
            --color-priority-high: #ff9800;
            --color-priority-high-bg: var(--color-status-warning-bg);
            --color-priority-medium: #2196f3;
            --color-priority-medium-bg: var(--color-status-info-bg);
            --color-priority-low: #4caf50;
            --color-priority-low-bg: var(--color-status-success-bg);
        }

        /* Dark mode specific adjustments */
        [data-theme="dark"] .stat-card-blue,
        [data-theme="dark"] .stat-card-green,
        [data-theme="dark"] .stat-card-orange,
        [data-theme="dark"] .stat-card-red {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
        }

        [data-theme="dark"] input,
        [data-theme="dark"] select,
        [data-theme="dark"] textarea {
            background-color: var(--color-surface);
            color: var(--color-text-primary);
            border-color: var(--color-border);
        }

        [data-theme="dark"] input:focus,
        [data-theme="dark"] select:focus,
        [data-theme="dark"] textarea:focus {
            background-color: var(--color-surface);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 1px var(--color-primary);
        }

        [data-theme="dark"] input::placeholder,
        [data-theme="dark"] textarea::placeholder {
            color: var(--color-text-muted);
        }

        [data-theme="dark"] table thead {
            background-color: var(--color-surface) !important;
            border-color: var(--color-border);
        }

        [data-theme="dark"] table tbody tr {
            background-color: var(--color-background) !important;
            border-color: var(--color-border);
        }

        [data-theme="dark"] table tbody tr:hover {
            background-color: var(--color-surface) !important;
        }

        [data-theme="dark"] .sla-card {
            background-color: var(--color-surface) !important;
        }

        /* Additional Dark Mode Improvements */
        [data-theme="dark"] .badge-success,
        [data-theme="dark"] .badge-warning,
        [data-theme="dark"] .badge-error,
        [data-theme="dark"] .badge-info,
        [data-theme="dark"] .badge-priority-critical,
        [data-theme="dark"] .badge-priority-high,
        [data-theme="dark"] .badge-priority-medium,
        [data-theme="dark"] .badge-priority-low {
            color: var(--color-text-primary);
            font-weight: 600;
        }

        [data-theme="dark"] .progress-bar {
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
        }

        [data-theme="dark"] .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .border-t {
            border-color: var(--color-border) !important;
        }

        [data-theme="dark"] .border-b {
            border-color: var(--color-border) !important;
        }

        [data-theme="dark"] .divide-y > * + * {
            border-color: var(--color-border) !important;
        }

        /* Dark mode modal */
        [data-theme="dark"] #updateModal .bg-surface {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
        }

        /* Dark mode notification */
        [data-theme="dark"] #notification {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        /* Transition for smooth theme switching */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Theme Toggle Switch */
        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-gray-medium);
            transition: .4s;
            border-radius: 24px;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .theme-slider {
            background-color: var(--color-primary);
        }

        input:checked + .theme-slider:before {
            transform: translateX(24px);
        }

        [data-theme="dark"] .theme-slider:before {
            background-color: var(--color-text-primary);
        }
        
        body {
            font-family: var(--font-family);
        }
        
        .section { 
            display: none; 
        }
        
        .section.active { 
            display: block; 
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .sla-card {
            border: 2px solid var(--color-border);
            transition: all 0.3s ease;
        }
        
        .sla-card.collapsed {
            border-color: var(--color-status-success);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-gray-medium);
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--color-primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        /* Custom Tailwind overrides */
        .bg-background {
            background-color: var(--color-background);
        }
        
        .bg-surface {
            background-color: var(--color-surface);
        }
        
        .text-primary-color {
            color: var(--color-text-primary);
        }
        
        .text-secondary-color {
            color: var(--color-text-secondary);
        }
        
        .text-muted {
            color: var(--color-text-muted);
        }
        
        .border-color {
            border-color: var(--color-border);
        }
        
        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }
        
        .btn-secondary {
            border: 1px solid var(--color-border);
            color: var(--color-text-primary);
        }
        
        .btn-secondary:hover {
            background-color: var(--color-gray-light);
        }
        
        .btn-danger {
            background-color: var(--color-status-error);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #6B2A42;
        }
        
        .btn-success {
            background-color: var(--color-status-success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1F5630;
        }
        
        .link-primary {
            color: var(--color-primary);
        }
        
        .link-primary:hover {
            color: var(--color-primary-hover);
        }
        
        .badge-success {
            background-color: var(--color-status-success-bg);
            color: var(--color-status-success);
        }
        
        .badge-warning {
            background-color: var(--color-status-warning-bg);
            color: var(--color-status-warning);
        }
        
        .badge-error {
            background-color: var(--color-status-error-bg);
            color: var(--color-status-error);
        }
        
        .badge-info {
            background-color: var(--color-status-info-bg);
            color: var(--color-status-info);
        }
        
        .badge-priority-critical {
            background-color: var(--color-priority-critical-bg);
            color: var(--color-priority-critical);
        }
        
        .badge-priority-high {
            background-color: var(--color-priority-high-bg);
            color: var(--color-priority-high);
        }
        
        .badge-priority-medium {
            background-color: var(--color-priority-medium-bg);
            color: var(--color-priority-medium);
        }
        
        .badge-priority-low {
            background-color: var(--color-priority-low-bg);
            color: var(--color-priority-low);
        }
        
        .progress-success {
            background-color: var(--color-status-success);
        }
        
        .progress-warning {
            background-color: var(--color-status-warning);
        }
        
        .progress-error {
            background-color: var(--color-status-error);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 1px var(--color-primary);
        }
        
        .stat-card-blue {
            background-color: var(--color-status-info-bg);
        }
        
        .stat-card-green {
            background-color: var(--color-status-success-bg);
        }
        
        .stat-card-orange {
            background-color: var(--color-status-warning-bg);
        }
        
        .stat-card-red {
            background-color: var(--color-status-error-bg);
        }
        
        /* SLA Tab Styles */
        .sla-tab {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-right: 8px;
            padding: 10px 16px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .sla-tab.active {
            border-color: var(--color-primary);
            color: white;
            background: var(--color-primary);
        }
        
        .sla-tab:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }
        
        .sla-tab.invalid {
            border-color: #dc2626;
            color: #dc2626;
            background: #fef2f2;
        }

        .sla-tab.invalid.active {
            border-color: #dc2626;
            color: white;
            background: #dc2626;
        }

        .sla-tab.valid {
            border-color: #059669;
            color: #059669;
            background: #f0fdf4;
        }

        .sla-tab.valid.active {
            border-color: #059669;
            color: white;
            background: #059669;
        }

        .add-sla-button {
            background: white;
            border: 2px dashed #9ca3af;
            border-radius: 8px;
            padding: 10px 16px;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .add-sla-button:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: #f9fafb;
        }

        .tab-close-btn {
            opacity: 0.7;
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 16px;
            line-height: 1;
            font-weight: bold;
            transition: opacity 0.2s ease;
        }

        .tab-close-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        .sla-tab:not(.active) .tab-close-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }
        
        .sla-form-container {
            display: none;
        }
        
        .sla-form-container.active {
            display: block;
        }
    </style>
</head>
<body class="bg-background">
    <!-- Navigation -->
    <nav class="bg-surface shadow-sm border-b border-color">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-semibold text-primary-color">SLA Tracker</h1>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex space-x-4">
                        <button onclick="showSection('dashboard')" id="nav-dashboard" class="nav-btn link-primary font-medium">Dashboard</button>
                        <button onclick="showSection('list')" id="nav-list" class="nav-btn text-secondary-color hover:text-primary-color">All SLAs</button>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-secondary-color">üåû</span>
                        <label class="theme-toggle">
                            <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                            <span class="theme-slider"></span>
                        </label>
                        <span class="text-sm text-secondary-color">üåô</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <div id="dashboard" class="section active">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-surface p-6 rounded-lg shadow-sm">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-secondary-color">Total SLAs</p>
                            <p class="text-3xl font-bold text-primary-color">12</p>
                        </div>
                        <div class="w-12 h-12 stat-card-blue rounded-lg flex items-center justify-center">
                            <span style="color: var(--color-status-info)">üìä</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-surface p-6 rounded-lg shadow-sm">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-secondary-color">Met SLAs</p>
                            <p class="text-3xl font-bold" style="color: var(--color-status-success)">8</p>
                        </div>
                        <div class="w-12 h-12 stat-card-green rounded-lg flex items-center justify-center">
                            <span style="color: var(--color-status-success)">‚úÖ</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-surface p-6 rounded-lg shadow-sm">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-secondary-color">At Risk</p>
                            <p class="text-3xl font-bold" style="color: var(--color-status-warning)">3</p>
                        </div>
                        <div class="w-12 h-12 stat-card-orange rounded-lg flex items-center justify-center">
                            <span style="color: var(--color-status-warning)">‚ö†Ô∏è</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-surface p-6 rounded-lg shadow-sm">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-secondary-color">Missed SLAs</p>
                            <p class="text-3xl font-bold" style="color: var(--color-status-error)">1</p>
                        </div>
                        <div class="w-12 h-12 stat-card-red rounded-lg flex items-center justify-center">
                            <span style="color: var(--color-status-error)">‚ùå</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-surface rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold text-primary-color">Recent SLAs</h2>
                        <button onclick="showSection('list')" class="link-primary text-sm hover:underline">View all</button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between py-3 border-b border-color">
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-primary-color cursor-pointer hover:text-primary" style="color: var(--color-text-primary)" onclick="showSection('detail')">API Response Time</h4>
                                <p class="text-xs text-muted">TIMELINESS</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 bg-gray-light rounded-full h-2" style="background-color: var(--color-gray-light)">
                                        <div class="progress-success h-2 rounded-full progress-bar" style="width: 95%"></div>
                                    </div>
                                    <span class="text-sm text-secondary-color">95%</span>
                                </div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium badge-success">met</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between py-3 border-b border-color">
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-primary-color cursor-pointer hover:text-primary" style="color: var(--color-text-primary)" onclick="showSection('detail')">Database Uptime</h4>
                                <p class="text-xs text-muted">AVAILABILITY</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 rounded-full h-2" style="background-color: var(--color-gray-light)">
                                        <div class="progress-warning h-2 rounded-full progress-bar" style="width: 78%"></div>
                                    </div>
                                    <span class="text-sm text-secondary-color">78%</span>
                                </div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium badge-warning">at risk</span>
                            </div>
                        </div>

                        <div class="flex items-center justify-between py-3 border-b border-color">
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-primary-color cursor-pointer hover:text-primary" style="color: var(--color-text-primary)" onclick="showSection('detail')">Customer Support Tasks</h4>
                                <p class="text-xs text-muted">QUANTITY</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 rounded-full h-2" style="background-color: var(--color-gray-light)">
                                        <div class="progress-success h-2 rounded-full progress-bar" style="width: 100%"></div>
                                    </div>
                                    <span class="text-sm text-secondary-color">100%</span>
                                </div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium badge-success">met</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-surface rounded-lg shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-primary-color">SLA Performance</h2>
                    <div class="h-64 flex items-center justify-center">
                        <div class="w-full">
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-secondary-color">This Month</span>
                                    <span class="text-sm font-medium" style="color: var(--color-status-success)">85% Success Rate</span>
                                </div>
                                <div class="w-full rounded-full h-4" style="background-color: var(--color-gray-light)">
                                    <div class="progress-success h-4 rounded-full progress-bar" style="width: 85%"></div>
                                </div>
                                
                                <div class="grid grid-cols-3 gap-4 mt-6">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold" style="color: var(--color-status-success)">67%</div>
                                        <div class="text-xs text-muted">Met</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold" style="color: var(--color-status-warning)">25%</div>
                                        <div class="text-xs text-muted">At Risk</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold" style="color: var(--color-status-error)">8%</div>
                                        <div class="text-xs text-muted">Missed</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create SLA Section -->
    <div id="create" class="section">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="bg-surface rounded-lg shadow-sm p-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <button type="button" onclick="goBack()" class="px-4 py-2 rounded-md btn-secondary flex items-center gap-2">
                            <span>‚Üê</span> Back
                        </button>
                        <h2 class="text-2xl font-bold text-primary-color">Create SLAs</h2>
                    </div>
                    <button type="submit" onclick="submitSLAs()" class="px-6 py-2 rounded-md btn-primary" id="topSubmitButton" style="display: none;">
                        Create All SLAs
                    </button>
                </div>
                
                <!-- SLA Tabs -->
                <div class="mb-6">
                    <div class="flex items-center gap-2 p-4 bg-gray-50 rounded-lg">
                        <nav class="flex gap-2" id="slaTabs">
                            <!-- Tabs will be added here dynamically -->
                            <button type="button" onclick="addNewSLA()" 
                                    class="add-sla-button">
                                <span>+</span> Add SLA
                            </button>
                        </nav>
                    </div>
                </div>
                
                <form id="createSlaForm" class="space-y-6">
                    <div id="slaContainer">
                        <!-- SLA forms will be added here dynamically -->
                    </div>
                </form>
            </div>
        </div>
    </div>

<!-- SLA List Section -->
<div id="list" class="section">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Task Selection Grid (Initial View) -->
        <div id="task-selection-view">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-primary-color mb-2">All SLAs</h2>
                <p class="text-muted">Select a task to view related SLAs</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6">
                <div onclick="showTaskSLAs('Task 1')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">1</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 1</h3>
                        <p class="text-sm text-muted">Program Management</p>
                        <div class="mt-3">
                            <span id="task-1-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 2')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">2</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 2</h3>
                        <p class="text-sm text-muted">Multi-Team Support</p>
                        <div class="mt-3">
                            <span id="task-2-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 3')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">3</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 3</h3>
                        <p class="text-sm text-muted">PPM Operations</p>
                        <div class="mt-3">
                            <span id="task-3-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 4')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">4</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 4</h3>
                        <p class="text-sm text-muted">Technical Evaluation</p>
                        <div class="mt-3">
                            <span id="task-4-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 5')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">5</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 5</h3>
                        <p class="text-sm text-muted">Training Support</p>
                        <div class="mt-3">
                            <span id="task-5-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 6')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">6</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 6</h3>
                        <p class="text-sm text-muted">Business Intelligence</p>
                        <div class="mt-3">
                            <span id="task-6-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 7')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">7</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 7</h3>
                        <p class="text-sm text-muted">Operational Support</p>
                        <div class="mt-3">
                            <span id="task-7-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 8')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">8</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 8</h3>
                        <p class="text-sm text-muted">Quality Support</p>
                        <div class="mt-3">
                            <span id="task-8-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
                
                <div onclick="showTaskSLAs('Task 9')" class="task-card cursor-pointer bg-surface rounded-lg p-6 border border-color hover:border-primary-color transition-colors duration-200 hover:shadow-md">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-primary-color rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold">9</span>
                        </div>
                        <h3 class="text-lg font-semibold text-primary-color mb-2">Task 9</h3>
                        <p class="text-sm text-muted">Communication</p>
                        <div class="mt-3">
                            <span id="task-9-count" class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">0 SLAs</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Filtered SLA Table View (Hidden by default) -->
        <div id="filtered-sla-view" style="display: none;">
            <!-- Header with Back Button -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                <div class="flex items-center mb-4 sm:mb-0">
                    <button onclick="showTaskSelection()" class="mr-4 text-secondary-color hover:text-primary-color flex items-center">
                        ‚Üê Back to Tasks
                    </button>
                    <h2 id="filtered-task-title" class="text-2xl font-bold text-primary-color">Task SLAs</h2>
                </div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="showSection('create')" class="px-4 py-2 rounded-md btn-primary">+ Add SLA</button>
                </div>
            </div>

            <!-- SLA Table -->
            <div class="bg-surface rounded-lg shadow-sm overflow-hidden">
                <table class="w-full">
                    <thead class="border-b border-color" style="background-color: var(--color-gray-light)">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">SLA Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Team</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Progress</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">End Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="filtered-sla-table-body" class="bg-surface divide-y" style="border-color: var(--color-border)">
                        <!-- Dynamic content will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

    <!-- SLA Detail Section -->
    <div id="detail" class="section">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <button onclick="showSection('list')" class="mr-4 text-secondary-color hover:text-primary-color">‚Üê Back to List</button>
                    <h2 class="text-2xl font-bold text-primary-color">API Response Performance SLA</h2>
                </div>
                <div class="flex space-x-3">
                    <button onclick="showUpdateModal()" class="px-4 py-2 rounded-md btn-success">Update Progress</button>
                    <button onclick="editCurrentSLA()" class="px-4 py-2 rounded-md btn-secondary">Edit</button>
                    <button class="px-4 py-2 rounded-md btn-danger">Delete</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Content -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- SLA Overview -->
                    <div class="bg-surface rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-primary-color mb-4">Overview</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <span class="text-sm text-muted">SLA Name</span>
                                    <p class="text-sm font-medium text-primary-color">API Response Performance</p>
                                </div>
                                <div>
                                    <span class="text-sm text-muted">Type</span>
                                    <p class="text-sm font-medium text-primary-color">Timeliness</p>
                                </div>
                                <div>
                                    <span class="text-sm text-muted">Team</span>
                                    <p class="text-sm font-medium text-primary-color">Engineering</p>
                                </div>
                                <div>
                                    <span class="text-sm text-muted">Task</span>
                                    <p class="text-sm font-medium text-primary-color">Monitoring API Response Times</p>
                                </div>
                                <div>
                                    <span class="text-sm text-muted">Created</span>
                                    <p class="text-sm font-medium text-primary-color">Oct 1, 2024</p>
                                </div>
                            </div>
                            <div>
                                <span class="text-sm text-muted">Description</span>
                                <p class="text-sm text-primary-color mt-1">Monitor API response times to ensure they stay under 200ms for optimal user experience. This is critical for our customer-facing applications.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Tracking -->
                    <div class="bg-surface rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-primary-color mb-4">Progress Tracking</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                                    <div class="text-2xl font-bold text-primary-color">150ms</div>
                                    <div class="text-sm text-muted">Current Avg</div>
                                </div>
                                <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                                    <div class="text-2xl font-bold text-primary-color">200ms</div>
                                    <div class="text-sm text-muted">Target Max</div>
                                </div>
                                <div class="text-center p-4 rounded-lg stat-card-green">
                                    <div class="text-2xl font-bold" style="color: var(--color-status-success)">95%</div>
                                    <div class="text-sm text-muted">Success Rate</div>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-primary-color">Overall Progress</span>
                                    <span class="text-sm text-muted">95%</span>
                                </div>
                                <div class="w-full rounded-full h-3" style="background-color: var(--color-gray-light)">
                                    <div class="progress-success h-3 rounded-full progress-bar" style="width: 95%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div class="bg-surface rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-primary-color mb-4">Activity Log</h3>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3 py-2">
                                <div class="w-2 h-2 rounded-full mt-2" style="background-color: var(--color-status-success)"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-primary-color">SLA target met - Response time averaged 145ms</p>
                                    <p class="text-xs text-muted">2 hours ago</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 py-2">
                                <div class="w-2 h-2 rounded-full mt-2" style="background-color: var(--color-status-info)"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-primary-color">Progress updated - Current average: 150ms</p>
                                    <p class="text-xs text-muted">1 day ago</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 py-2">
                                <div class="w-2 h-2 rounded-full mt-2" style="background-color: var(--color-status-warning)"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-primary-color">Warning: Response time spike detected (230ms average)</p>
                                    <p class="text-xs text-muted">3 days ago</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 py-2">
                                <div class="w-2 h-2 rounded-full mt-2" style="background-color: var(--color-gray-medium)"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-primary-color">SLA created</p>
                                    <p class="text-xs text-muted">Oct 1, 2024</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Status Card -->
                    <div class="bg-surface rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-primary-color mb-4">Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">Current Status</span>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium badge-success">Met</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">Time Remaining</span>
                                <span class="text-sm font-medium text-primary-color">67 days</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">End Date</span>
                                <span class="text-sm font-medium text-primary-color">Dec 31, 2024</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="bg-surface rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-primary-color mb-4">Quick Stats</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">Best Response</span>
                                <span class="text-sm font-medium" style="color: var(--color-status-success)">89ms</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">Worst Response</span>
                                <span class="text-sm font-medium" style="color: var(--color-status-error)">245ms</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">Total Requests</span>
                                <span class="text-sm font-medium text-primary-color">125,439</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted">Violations</span>
                                <span class="text-sm font-medium" style="color: var(--color-status-error)">6,272</span>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="bg-surface rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-primary-color mb-4">Notifications</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-primary-color">At Risk Alerts</span>
                                <div class="w-5 h-5 rounded-full flex items-center justify-center" style="background-color: var(--color-status-success)">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-primary-color">Miss Notifications</span>
                                <div class="w-5 h-5 rounded-full flex items-center justify-center" style="background-color: var(--color-status-success)">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </div>
                            
                            <div class="mt-3 pt-3 border-t border-color">
                                <span class="text-sm text-muted">Email</span>
                                <p class="text-sm font-medium text-primary-color">admin@company.com</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Progress Modal -->
    <div id="updateModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-surface rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold text-primary-color mb-4">Update Progress</h3>
            <div class="space-y-4">
                <div>
                    <label for="currentValue" class="block text-sm font-medium text-primary-color mb-2">Current Value</label>
                    <input type="number" id="currentValue" value="150" 
                           class="w-full px-3 py-2 border border-color rounded-md">
                </div>
                <div>
                    <label for="updateNotes" class="block text-sm font-medium text-primary-color mb-2">Notes</label>
                    <textarea id="updateNotes" rows="3" placeholder="Optional notes about this update..."
                              class="w-full px-3 py-2 border border-color rounded-md"></textarea>
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="hideUpdateModal()" class="px-4 py-2 rounded-md btn-secondary">Cancel</button>
                <button onclick="saveUpdate()" class="px-4 py-2 rounded-md btn-primary">Save Update</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="hidden fixed top-4 right-4 px-6 py-3 rounded-md z-50"></div>

<script>
        // Global Variables
        let slaCounter = 0;
        let currentSlaId = null;
        let isEditMode = false;
        let editingSlaId = null;
        
        // DOM Element Cache for Performance
        const domCache = {
            notification: null,
            taskSelectionView: null,
            filteredSlaView: null,
            init() {
                this.notification = document.getElementById('notification');
                this.taskSelectionView = document.getElementById('task-selection-view');
                this.filteredSlaView = document.getElementById('filtered-sla-view');
            }
        };
        
        // Initialize DOM cache when page loads
        document.addEventListener('DOMContentLoaded', () => {
            domCache.init();
        });

        // Demo Data - Comprehensive examples of all SLA types and configurations
const demoData = {
    timestamp: "2024-10-15T20:00:00.000Z",
    slaCount: 10,
    slas: [
        {
            id: "sla-001",
            slaName: "Document Processing Volume",
            teamName: "Program Management Team",
            description: "Process between 100-150 documents per month with quality review and approval workflow.",
            taskName: "Task 1",
            slaType: "quantity",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "met",
            progress: 92,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "processing-team@company.com"
            },
            configuration: {
                action: "processing",
                unit: "documents",
                targetType: "range",
                target: {
                    min: 100,
                    max: 150
                }
            },
            currentValue: 138,
            metrics: {
                completed: 138,
                inProgress: 12,
                avgProcessingTime: 2.5,
                qualityScore: 4.8
            },
            activityLog: [
                {
                    type: "success",
                    message: "Successfully processed 138 documents - within target range",
                    timestamp: "2 hours ago"
                },
                {
                    type: "info",
                    message: "New acquisition added to portfolio",
                    timestamp: "3 days ago"
                }
            ]
        },
        {
            id: "sla-002",
            slaName: "Service Desk Tickets",
            teamName: "APM Team",
            description: "Resolve exactly 500 service desk tickets per month with proper categorization and documentation.",
            taskName: "Task 2",
            slaType: "quantity",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "at-risk",
            progress: 76,
            notifications: {
                onRisk: true,
                onMiss: false,
                email: "it-support@company.com"
            },
            configuration: {
                action: "resolving",
                unit: "tickets",
                targetType: "single",
                target: 500
            },
            currentValue: 380,
            metrics: {
                completed: 380,
                pending: 45,
                avgResolutionTime: 4.2,
                satisfactionRating: 4.3
            },
            activityLog: [
                {
                    type: "warning",
                    message: "Currently 120 tickets behind monthly target",
                    timestamp: "30 minutes ago"
                },
                {
                    type: "info",
                    message: "CRB submission completed ahead of schedule",
                    timestamp: "1 day ago"
                }
            ]
        },
        {
            id: "sla-003",
            slaName: "Customer Satisfaction Rate",
            teamName: "PPM Team",
            description: "Maintain customer satisfaction between 85-95% through regular surveys and feedback collection.",
            taskName: "Task 3",
            slaType: "percentage",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "met",
            progress: 89,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "customer-success@company.com"
            },
            configuration: {
                action: "maintaining",
                unit: "customer satisfaction",
                targetType: "range",
                target: {
                    min: 85,
                    max: 95
                }
            },
            currentValue: 89.2,
            metrics: {
                totalSurveys: 450,
                positiveResponses: 401,
                averageRating: 4.5,
                responseRate: 78
            },
            activityLog: [
                {
                    type: "success",
                    message: "89.2% satisfaction rate - within target range",
                    timestamp: "4 hours ago"
                },
                {
                    type: "info",
                    message: "Quarterly satisfaction survey completed",
                    timestamp: "1 day ago"
                }
            ]
        },
        {
            id: "sla-004",
            slaName: "System Uptime",
            teamName: "Technical Evaluation Team",
            description: "Maintain exactly 99.9% system uptime for critical business applications and services.",
            taskName: "Task 4",
            slaType: "percentage",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "exceeded",
            progress: 101,
            notifications: {
                onRisk: false,
                onMiss: true,
                email: "infrastructure@company.com"
            },
            configuration: {
                action: "maintaining",
                unit: "system uptime",
                targetType: "single",
                target: 99.9
            },
            currentValue: 99.95,
            metrics: {
                totalDowntime: 2.16,
                plannedMaintenance: 1.5,
                unplannedOutages: 0.66,
                mttr: 15
            },
            activityLog: [
                {
                    type: "success",
                    message: "Exceeded target with 99.95% uptime",
                    timestamp: "1 hour ago"
                },
                {
                    type: "info",
                    message: "Scheduled maintenance completed with zero unplanned downtime",
                    timestamp: "2 days ago"
                }
            ]
        },
        {
            id: "sla-005",
            slaName: "Monthly Financial Reports",
            teamName: "Training Support Team",
            description: "Deliver comprehensive monthly financial reports by the 5th business day of each month.",
            taskName: "Task 5",
            slaType: "timeliness",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "met",
            progress: 95,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "finance@company.com"
            },
            configuration: {
                action: "delivering",
                unit: "financial reports",
                cadence: "monthly",
                targetDay: 5,
                targetTime: "17:00"
            },
            currentValue: "2024-10-03T16:45:00Z",
            metrics: {
                onTimeDeliveries: 9,
                totalDeliveries: 10,
                avgDeliveryDay: 4.2,
                qualityScore: 4.7
            },
            activityLog: [
                {
                    type: "success",
                    message: "October report delivered on day 3 - ahead of schedule",
                    timestamp: "2 days ago"
                },
                {
                    type: "info",
                    message: "All quarterly compliance reviews completed on schedule",
                    timestamp: "1 week ago"
                }
            ]
        },
        {
            id: "sla-006",
            slaName: "Quarterly Compliance Reviews",
            teamName: "Business Intelligence Team",
            description: "Complete comprehensive compliance reviews every quarter by the 15th day of the quarter.",
            taskName: "Task 6",
            slaType: "timeliness",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "at-risk",
            progress: 75,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "compliance@company.com"
            },
            configuration: {
                action: "completing",
                unit: "compliance reviews",
                cadence: "quarterly", 
                targetDay: 15,
                targetTime: "12:00"
            },
            currentValue: "2024-10-18T14:30:00Z",
            metrics: {
                onTimeReviews: 3,
                totalReviews: 4,
                avgCompletionDay: 16.5,
                issuesIdentified: 23
            },
            activityLog: [
                {
                    type: "warning",
                    message: "Q4 review completed 3 days late",
                    timestamp: "3 hours ago"
                },
                {
                    type: "info",
                    message: "Q3 review completed ahead of schedule with 12 findings",
                    timestamp: "6 weeks ago"
                }
            ]
        },
        {
            id: "sla-007",
            slaName: "Help Desk Support Availability",
            teamName: "Operational Support Team",
            description: "Provide live help desk support during business hours (9 AM - 5 PM EST) with immediate response capability.",
            taskName: "Task 7",
            slaType: "availability",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "met",
            progress: 98,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "helpdesk@company.com"
            },
            configuration: {
                action: "providing",
                unit: "help desk support",
                schedule: "business-hours",
                startTime: "09:00",
                endTime: "17:00",
                timezone: "EST",
                days: ["monday", "tuesday", "wednesday", "thursday", "friday"]
            },
            currentValue: true,
            metrics: {
                totalHours: 2080,
                availableHours: 2038,
                avgResponseTime: 45,
                callsAnswered: 2847
            },
            activityLog: [
                {
                    type: "success",
                    message: "98% availability maintained during business hours",
                    timestamp: "1 day ago"
                },
                {
                    type: "info",
                    message: "Phone system upgrade completed successfully",
                    timestamp: "3 days ago"
                }
            ]
        },
        {
            id: "sla-008",
            slaName: "Server Monitoring 24/7",
            teamName: "Quality Support Team",
            description: "Maintain continuous 24/7 monitoring of critical server infrastructure with automated alerting and response.",
            taskName: "Task 8",
            slaType: "availability", 
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "met",
            progress: 99,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "operations@company.com"
            },
            configuration: {
                action: "monitoring",
                unit: "server infrastructure",
                schedule: "24/7",
                startTime: "00:00",
                endTime: "23:59",
                timezone: "UTC",
                days: ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"]
            },
            currentValue: true,
            metrics: {
                totalHours: 8760,
                monitoredHours: 8672,
                alerts: 147,
                falsePositives: 12
            },
            activityLog: [
                {
                    type: "success",
                    message: "99% monitoring uptime maintained",
                    timestamp: "2 hours ago"
                },
                {
                    type: "info",
                    message: "Critical server alert resolved within 5 minutes",
                    timestamp: "6 hours ago"
                }
            ]
        },
        {
            id: "sla-009",
            slaName: "Data Backup Compliance",
            teamName: "Communication Team",
            description: "Ensure all critical data backup procedures are completed successfully according to regulatory requirements.",
            taskName: "Task 9",
            slaType: "compliance",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "met",
            progress: 100,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "data-management@company.com"
            },
            configuration: {
                action: "ensuring",
                unit: "backup compliance",
                targetValue: true
            },
            currentValue: true,
            metrics: {
                backupsCompleted: 365,
                successfulBackups: 365,
                averageBackupTime: 2.3,
                complianceAudits: 4
            },
            activityLog: [
                {
                    type: "success",
                    message: "All backup procedures completed successfully",
                    timestamp: "1 hour ago"
                },
                {
                    type: "info",
                    message: "Quarterly compliance audit passed with 100% score",
                    timestamp: "2 weeks ago"
                }
            ]
        },
        {
            id: "sla-010",
            slaName: "Security Training Completion",
            teamName: "TW/Template Team",
            description: "Verify that mandatory security training has NOT been completed by all staff members due to scheduling conflicts.",
            taskName: "Task 2",
            slaType: "compliance",
            startDate: "2024-01-01",
            endDate: "2024-12-31",
            status: "missed",
            progress: 15,
            notifications: {
                onRisk: true,
                onMiss: true,
                email: "security@company.com"
            },
            configuration: {
                action: "verifying",
                unit: "training completion",
                targetValue: false
            },
            currentValue: false,
            metrics: {
                totalStaff: 150,
                completedTraining: 127,
                pendingTraining: 23,
                overdue: 8
            },
            activityLog: [
                {
                    type: "error",
                    message: "Training completion target not met - 23 staff members still pending",
                    timestamp: "1 day ago"
                },
                {
                    type: "warning",
                    message: "8 staff members are overdue for security training",
                    timestamp: "3 days ago"
                }
            ]
        }
    ]
};

        // Utility Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function getStatusBadgeClass(status) {
            switch (status) {
                case 'met': return 'badge-success';
                case 'at-risk': return 'badge-warning';
                case 'missed': return 'badge-error';
                default: return 'badge-info';
            }
        }

        function getProgressBarClass(status) {
            switch (status) {
                case 'met': return 'progress-success';
                case 'at-risk': return 'progress-warning';
                case 'missed': return 'progress-error';
                default: return 'progress-success';
            }
        }

        function getActivityIconColor(type) {
            switch (type) {
                case 'success': return 'var(--color-status-success)';
                case 'warning': return 'var(--color-status-warning)';
                case 'error': return 'var(--color-status-error)';
                case 'info': return 'var(--color-status-info)';
                default: return 'var(--color-gray-medium)';
            }
        }

        // Render Functions
        function renderSLAList() {
            const tbody = document.querySelector('#list tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            demoData.slas.forEach(sla => {
                const row = document.createElement('tr');
                row.style.backgroundColor = 'white';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-primary-color cursor-pointer link-primary" onclick="showSLADetail('${sla.id}')">${sla.slaName}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">${sla.slaType.charAt(0).toUpperCase() + sla.slaType.slice(1)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">${sla.teamName}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadgeClass(sla.status)}">${sla.status.replace('-', ' ')}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-16 rounded-full h-2 mr-2" style="background-color: var(--color-gray-light)">
                                <div class="${getProgressBarClass(sla.status)} h-2 rounded-full" style="width: ${sla.progress}%"></div>
                            </div>
                            <span class="text-sm text-secondary-color">${sla.progress}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">${formatDate(sla.endDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="showSLADetail('${sla.id}')" class="link-primary mr-3">View</button>
                        <button onclick="deleteSLA('${sla.id}')" style="color: var(--color-status-error)" class="hover:opacity-80">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

function renderSLADetail(slaId) {
    const sla = demoData.slas.find(s => s.id === slaId);
    if (!sla) return;
    
    // Calculate current progress
    const currentProgress = calculateProgress(sla);
    sla.progress = currentProgress; // Update the stored progress

    // Update header
    const detailHeader = document.querySelector('#detail h2');
    if (detailHeader) {
        detailHeader.textContent = sla.slaName + ' SLA';
    }

    // Update overview section
    const overviewSection = document.querySelector('#detail .bg-surface');
    if (overviewSection) {
        const overviewContent = overviewSection.querySelector('.space-y-4');
        if (overviewContent) {
            overviewContent.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="text-sm text-muted">SLA Name</span>
                        <p class="text-sm font-medium text-primary-color">${sla.slaName}</p>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Type</span>
                        <p class="text-sm font-medium text-primary-color">${sla.slaType.charAt(0).toUpperCase() + sla.slaType.slice(1)}</p>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Team</span>
                        <p class="text-sm font-medium text-primary-color">${sla.teamName}</p>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Task</span>
                        <p class="text-sm font-medium text-primary-color">${sla.taskName}</p>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Created</span>
                        <p class="text-sm font-medium text-primary-color">${formatDate(sla.startDate)}</p>
                    </div>
                </div>
                <div>
                    <span class="text-sm text-muted">Description</span>
                    <p class="text-sm text-primary-color mt-1">${sla.description}</p>
                </div>
            `;
        }
    }

    // Update progress tracking section
    renderProgressTracking(sla);

    // Update activity log
    renderActivityLog(sla);

    // Update sidebar
    renderSLASidebar(sla);
}

function editCurrentSLA() {
    if (!currentSlaId) return;
    
    const sla = demoData.slas.find(s => s.id === currentSlaId);
    if (!sla) return;
    
    isEditMode = true;
    editingSlaId = currentSlaId;
    
    // Clear existing SLA forms and tabs
    const slaContainer = document.getElementById('slaContainer');
    const tabsContainer = document.getElementById('slaTabs');
    slaContainer.innerHTML = '';
    
    // Clear all tabs except the Add button
    const addButton = tabsContainer.querySelector('button[onclick="addNewSLA()"]');
    tabsContainer.innerHTML = '';
    tabsContainer.appendChild(addButton);
    
    // Hide submit button initially
    const submitContainer = document.getElementById('submitButtonContainer');
    if (submitContainer) {
        submitContainer.style.display = 'none';
    }
    
    // Reset slaCounter
    slaCounter = 0;
    
    // Update the header and submit button
    const header = document.querySelector('#create h2');
    const submitButton = document.querySelector('#create button[type="submit"]');
    
    if (header) header.textContent = 'Edit SLA';
    if (submitButton) submitButton.textContent = 'Update SLA';
    
    // Navigate to create section first
    showSection('create');
    
    // Add the form and populate it
    setTimeout(() => {
        addNewSLA();
        // Wait for the form to be fully rendered
        setTimeout(() => {
            populateSLAForm(slaCounter, sla);
            // Update tab title with SLA name
            updateTabTitle(slaCounter, sla.slaName || 'Edit SLA');
        }, 100);
    }, 100);
}

// Add this function to populate the form with existing data
function populateSLAForm(formId, sla) {
    console.log('Populating form with:', sla);
    
    // Helper functions
    const setFieldValue = (fieldId, value) => {
        const field = document.getElementById(`${fieldId}-${formId}`);
        if (field) {
            field.value = value || '';
            console.log(`Set ${fieldId}:`, value);
        } else {
            console.warn(`Field not found: ${fieldId}-${formId}`);
        }
    };
    
    const setCheckboxValue = (fieldId, value) => {
        const field = document.getElementById(`${fieldId}-${formId}`);
        if (field) {
            field.checked = Boolean(value);
            console.log(`Set checkbox ${fieldId}:`, value);
        } else {
            console.warn(`Checkbox not found: ${fieldId}-${formId}`);
        }
    };
    
    // Populate basic fields
    setFieldValue('slaName', sla.slaName);
    setFieldValue('teamName', sla.teamName);
    setFieldValue('description', sla.description);
    setFieldValue('taskName', sla.taskName);
    setFieldValue('startDate', sla.startDate);
    setFieldValue('endDate', sla.endDate);
    setFieldValue('notificationEmail', sla.notifications?.email);
    setCheckboxValue('notifyOnRisk', sla.notifications?.onRisk);
    setCheckboxValue('notifyOnMiss', sla.notifications?.onMiss);
    
    // Set SLA type and show configuration
    const slaTypeField = document.getElementById(`slaType-${formId}`);
    if (slaTypeField && sla.slaType) {
        slaTypeField.value = sla.slaType;
        
        // Manually call showSLAConfig to display the right configuration
        showSLAConfig(formId, sla.slaType);
        
        // Wait for configuration section to be shown, then populate specific fields
        setTimeout(() => {
            populateTypeSpecificFields(formId, sla);
            
            // Trigger validation update after population
            const tabId = formId.replace('edit-', '');
            updateTabValidation(tabId);
        }, 200);
    }
}

// Separate function to populate type-specific fields
function populateTypeSpecificFields(formId, sla) {
    console.log('Populating type-specific fields for:', sla.slaType);
    
    const setFieldValue = (fieldId, value) => {
        const field = document.getElementById(`${fieldId}-${formId}`);
        if (field) {
            field.value = value || '';
            console.log(`Set ${fieldId}:`, value);
        } else {
            console.warn(`Field not found: ${fieldId}-${formId}`);
        }
    };
    
    const setCheckboxValue = (fieldId, value) => {
        const field = document.getElementById(`${fieldId}-${formId}`);
        if (field) {
            field.checked = Boolean(value);
            console.log(`Set checkbox ${fieldId}:`, value);
        }
    };
    
    if (!sla.configuration) return;
    
    switch (sla.slaType) {
        case 'quantity':
            setFieldValue('quantityAction', sla.configuration.action);
            setFieldValue('quantityUnit', sla.configuration.unit);
            
            if (sla.configuration.targetType === 'range') {
                setCheckboxValue('quantityRange', true);
                setTimeout(() => {
                    toggleQuantityRange(formId);
                    setTimeout(() => {
                        const minField = document.querySelector(`#quantityTarget-${formId} input[placeholder*="Minimum"]`);
                        const maxField = document.querySelector(`#quantityTarget-${formId} input[placeholder*="Maximum"]`);
                        if (minField && sla.configuration.target?.min) minField.value = sla.configuration.target.min;
                        if (maxField && sla.configuration.target?.max) maxField.value = sla.configuration.target.max;
                    }, 100);
                }, 50);
            } else if (typeof sla.configuration.target === 'number') {
                setFieldValue('quantityTargetValue', sla.configuration.target);
            }
            break;
            
        case 'percentage':
            if (sla.configuration.targetType === 'range') {
                setCheckboxValue('percentageRange', true);
                setTimeout(() => {
                    togglePercentageRange(formId);
                    setTimeout(() => {
                        const minField = document.querySelector(`#percentageTarget-${formId} input[placeholder*="Minimum"]`);
                        const maxField = document.querySelector(`#percentageTarget-${formId} input[placeholder*="Maximum"]`);
                        if (minField && sla.configuration.target?.min) minField.value = sla.configuration.target.min;
                        if (maxField && sla.configuration.target?.max) maxField.value = sla.configuration.target.max;
                    }, 100);
                }, 50);
            } else if (typeof sla.configuration.target === 'number') {
                setFieldValue('percentageTargetValue', sla.configuration.target);
            }
            break;
            
        case 'timeliness':
            setFieldValue('timelinessTarget', sla.configuration.targetValue);
            setFieldValue('timelinessCadence', sla.configuration.cadence);
            break;
            
        case 'availability':
            setFieldValue('availabilityStartTime', sla.configuration.startTime);
            setFieldValue('availabilityEndTime', sla.configuration.endTime);
            
            // Set day checkboxes
            if (sla.configuration.daysOfWeek && Array.isArray(sla.configuration.daysOfWeek)) {
                setTimeout(() => {
                    sla.configuration.daysOfWeek.forEach(day => {
                        const checkbox = document.querySelector(`input[name="availabilityDays-${formId}"][value="${day}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }, 50);
            }
            break;
            
        case 'compliance':
            const complianceValue = sla.configuration.targetValue === true ? 'yes' : 
                                    sla.configuration.targetValue === false ? 'no' : '';
            setFieldValue('complianceTarget', complianceValue);
            break;
    }
}

function calculateProgress(sla) {
    if (!sla.configuration || !sla.configuration.target) {
        return sla.progress || 0;
    }
    
    const current = sla.currentValue || 0;
    const target = sla.configuration.target;
    
    if (sla.configuration.targetType === 'range' && typeof target === 'object') {
        const min = target.min || 0;
        const max = target.max || min;
        
        if (current >= min) {
            // Once we hit the minimum, we're at 100%
            return 100;
        } else {
            // Calculate progress toward the minimum
            return Math.round((current / min) * 100);
        }
    } else if (typeof target === 'number') {
        return Math.min(Math.round((current / target) * 100), 100);
    } else {
        return sla.progress || 0;
    }
}

function renderProgressTracking(sla) {
    const progressSection = document.querySelectorAll('#detail .bg-surface')[1];
    if (!progressSection) return;

    const currentProgress = calculateProgress(sla);
    const metricsHtml = generateMetricsHTML(sla);
    const progressContent = progressSection.querySelector('.space-y-4');
    if (progressContent) {
        progressContent.innerHTML = `
            ${metricsHtml}
            <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-primary-color">Overall Progress</span>
                    <span class="text-sm text-muted">${currentProgress}%</span>
                </div>
                <div class="w-full rounded-full h-3" style="background-color: var(--color-gray-light)">
                    <div class="${getProgressBarClass(sla.status)} h-3 rounded-full progress-bar" style="width: ${currentProgress}%"></div>
                </div>
            </div>
        `;
    }
}

function generateMetricsHTML(sla) {
    switch (sla.slaType) {
        case 'timeliness':
            return `
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.currentValue}ms</div>
                        <div class="text-sm text-muted">Current Avg</div>
                    </div>
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.configuration.targetValue}ms</div>
                        <div class="text-sm text-muted">Target Max</div>
                    </div>
                    <div class="text-center p-4 rounded-lg stat-card-green">
                        <div class="text-2xl font-bold" style="color: var(--color-status-success)">${calculateProgress(sla)}%</div>
                        <div class="text-sm text-muted">Success Rate</div>
                    </div>
                </div>
            `;
        case 'quantity':
            const targetDisplay = getTargetDisplay(sla.configuration);
            const progressPercent = calculateProgress(sla);
            const statusText = sla.configuration.targetType === 'range' ? 
                (sla.currentValue >= sla.configuration.target.min ? 'Target Met' : 'In Progress') : 
                'Complete';
            return `
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.currentValue}</div>
                        <div class="text-sm text-muted">Current</div>
                    </div>
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${targetDisplay}</div>
                        <div class="text-sm text-muted">Target Range</div>
                    </div>
                    <div class="text-center p-4 rounded-lg ${progressPercent >= 100 ? 'stat-card-green' : 'stat-card-orange'}">
                        <div class="text-2xl font-bold" style="color: var(--color-status-${progressPercent >= 100 ? 'success' : 'warning'})">${progressPercent}%</div>
                        <div class="text-sm text-muted">${statusText}</div>
                    </div>
                </div>
            `;
        case 'percentage':
            const percentTargetDisplay = getTargetDisplay(sla.configuration);
            return `
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.currentValue}%</div>
                        <div class="text-sm text-muted">Current</div>
                    </div>
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${percentTargetDisplay}</div>
                        <div class="text-sm text-muted">Target</div>
                    </div>
                    <div class="text-center p-4 rounded-lg stat-card-green">
                        <div class="text-2xl font-bold" style="color: var(--color-status-success)">${calculateProgress(sla)}%</div>
                        <div class="text-sm text-muted">Complete</div>
                    </div>
                </div>
            `;
        case 'availability':
            return `
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.currentValue}%</div>
                        <div class="text-sm text-muted">Current Uptime</div>
                    </div>
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">99.5%</div>
                        <div class="text-sm text-muted">Target</div>
                    </div>
                    <div class="text-center p-4 rounded-lg ${sla.status === 'met' ? 'stat-card-green' : 'stat-card-orange'}">
                        <div class="text-2xl font-bold" style="color: var(--color-status-${sla.status === 'met' ? 'success' : 'warning'})">${calculateProgress(sla)}%</div>
                        <div class="text-sm text-muted">Health</div>
                    </div>
                </div>
            `;
        case 'compliance':
            return `
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.currentValue ? 'Yes' : 'No'}</div>
                        <div class="text-sm text-muted">Current Status</div>
                    </div>
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.configuration.targetValue ? 'Yes' : 'No'}</div>
                        <div class="text-sm text-muted">Target</div>
                    </div>
                    <div class="text-center p-4 rounded-lg ${sla.status === 'met' ? 'stat-card-green' : 'stat-card-red'}">
                        <div class="text-2xl font-bold" style="color: var(--color-status-${sla.status === 'met' ? 'success' : 'error'})">${calculateProgress(sla)}%</div>
                        <div class="text-sm text-muted">Complete</div>
                    </div>
                </div>
            `;
        default:
            const defaultTargetDisplay = getTargetDisplay(sla.configuration);
            return `
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${sla.currentValue}</div>
                        <div class="text-sm text-muted">Current</div>
                    </div>
                    <div class="text-center p-4 rounded-lg" style="background-color: var(--color-gray-light)">
                        <div class="text-2xl font-bold text-primary-color">${defaultTargetDisplay}</div>
                        <div class="text-sm text-muted">Target</div>
                    </div>
                    <div class="text-center p-4 rounded-lg stat-card-green">
                        <div class="text-2xl font-bold" style="color: var(--color-status-success)">${calculateProgress(sla)}%</div>
                        <div class="text-sm text-muted">Progress</div>
                    </div>
                </div>
            `;
    }
}

function getTargetDisplay(configuration) {
    if (!configuration || !configuration.target) {
        return 'N/A';
    }
    
    if (configuration.targetType === 'range' && typeof configuration.target === 'object') {
        const min = configuration.target.min || 0;
        const max = configuration.target.max || 0;
        return `${min}-${max}`;
    } else if (typeof configuration.target === 'number') {
        return configuration.target;
    } else {
        return configuration.target.toString();
    }
}

        function renderActivityLog(sla) {
            const activitySection = document.querySelectorAll('#detail .bg-surface')[2];
            if (!activitySection) return;

            const logContainer = activitySection.querySelector('.space-y-3');
            if (logContainer && sla.activityLog) {
                logContainer.innerHTML = sla.activityLog.map(activity => `
                    <div class="flex items-start space-x-3 py-2">
                        <div class="w-2 h-2 rounded-full mt-2" style="background-color: ${getActivityIconColor(activity.type)}"></div>
                        <div class="flex-1">
                            <p class="text-sm text-primary-color">${activity.message}</p>
                            <p class="text-xs text-muted">${activity.timestamp}</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderSLASidebar(sla) {
            // Update status card
            const statusCards = document.querySelectorAll('#detail .lg\\:col-span-1 .bg-surface');
            if (statusCards[0]) {
                const statusContent = statusCards[0].querySelector('.space-y-3');
                if (statusContent) {
                    const timeRemaining = calculateTimeRemaining(sla.endDate);
                    statusContent.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-muted">Current Status</span>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadgeClass(sla.status)}">${sla.status.replace('-', ' ')}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-muted">Time Remaining</span>
                            <span class="text-sm font-medium text-primary-color">${timeRemaining}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-muted">End Date</span>
                            <span class="text-sm font-medium text-primary-color">${formatDate(sla.endDate)}</span>
                        </div>
                    `;
                }
            }

            // Update quick stats (if available)
            if (statusCards[1] && sla.metrics) {
                const quickStatsContent = statusCards[1].querySelector('.space-y-3');
                if (quickStatsContent) {
                    quickStatsContent.innerHTML = generateQuickStatsHTML(sla);
                }
            }

            // Update notifications
            if (statusCards[2]) {
                const notificationContent = statusCards[2].querySelector('.space-y-3');
                if (notificationContent) {
                    notificationContent.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-primary-color">At Risk Alerts</span>
                            <div class="w-5 h-5 rounded-full flex items-center justify-center" style="background-color: var(--color-status-${sla.notifications.onRisk ? 'success' : 'error'})">
                                <span class="text-white text-xs">${sla.notifications.onRisk ? '‚úì' : '‚úï'}</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-primary-color">Miss Notifications</span>
                            <div class="w-5 h-5 rounded-full flex items-center justify-center" style="background-color: var(--color-status-${sla.notifications.onMiss ? 'success' : 'error'})">
                                <span class="text-white text-xs">${sla.notifications.onMiss ? '‚úì' : '‚úï'}</span>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-color">
                            <span class="text-sm text-muted">Email</span>
                            <p class="text-sm font-medium text-primary-color">${sla.notifications.email || 'None'}</p>
                        </div>
                    `;
                }
            }
        }

        function generateQuickStatsHTML(sla) {
            if (sla.slaType === 'timeliness' && sla.metrics) {
                return `
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted">Best Response</span>
                        <span class="text-sm font-medium" style="color: var(--color-status-success)">${sla.metrics.bestResponse}ms</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted">Worst Response</span>
                        <span class="text-sm font-medium" style="color: var(--color-status-error)">${sla.metrics.worstResponse}ms</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted">Total Requests</span>
                        <span class="text-sm font-medium text-primary-color">${sla.metrics.totalRequests.toLocaleString()}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted">Violations</span>
                        <span class="text-sm font-medium" style="color: var(--color-status-error)">${sla.metrics.violations.toLocaleString()}</span>
                    </div>
                `;
            }
            // Add other metric types as needed
            return `
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted">Current Value</span>
                    <span class="text-sm font-medium text-primary-color">${sla.currentValue}</span>
                </div>
            `;
        }

        function calculateTimeRemaining(endDate) {
            const now = new Date();
            const end = new Date(endDate);
            const diffTime = end - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) return 'Expired';
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return '1 day';
            return `${diffDays} days`;
        }

function updateDashboardStats() {
    const stats = {
        total: demoData.slas.length,
        met: demoData.slas.filter(sla => sla.status === 'met').length,
        atRisk: demoData.slas.filter(sla => sla.status === 'at-risk').length,
        missed: demoData.slas.filter(sla => sla.status === 'missed').length
    };

    // Update stat cards with actual data
    const statCards = document.querySelectorAll('#dashboard .bg-surface p.text-3xl');
    if (statCards[0]) statCards[0].textContent = stats.total;
    if (statCards[1]) statCards[1].textContent = stats.met;
    if (statCards[2]) statCards[2].textContent = stats.atRisk;
    if (statCards[3]) statCards[3].textContent = stats.missed;
    
    // Update performance percentages
    const successRate = stats.total > 0 ? Math.round((stats.met / stats.total) * 100) : 0;
    const atRiskRate = stats.total > 0 ? Math.round((stats.atRisk / stats.total) * 100) : 0;
    const missedRate = stats.total > 0 ? Math.round((stats.missed / stats.total) * 100) : 0;
    
    // Update the performance chart
    const performanceSection = document.querySelector('#dashboard .space-y-4');
    if (performanceSection) {
        const chartContainer = performanceSection.closest('.bg-surface').querySelector('.h-64');
        if (chartContainer) {
            chartContainer.innerHTML = `
                <div class="w-full">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-secondary-color">This Month</span>
                            <span class="text-sm font-medium" style="color: var(--color-status-success)">${successRate}% Success Rate</span>
                        </div>
                        <div class="w-full rounded-full h-4" style="background-color: var(--color-gray-light)">
                            <div class="progress-success h-4 rounded-full progress-bar" style="width: ${successRate}%"></div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mt-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold" style="color: var(--color-status-success)">${successRate}%</div>
                                <div class="text-xs text-muted">Met</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold" style="color: var(--color-status-warning)">${atRiskRate}%</div>
                                <div class="text-xs text-muted">At Risk</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold" style="color: var(--color-status-error)">${missedRate}%</div>
                                <div class="text-xs text-muted">Missed</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
    }
}

        function updateDashboardRecentSLAs() {
            const recentContainer = document.querySelector('#dashboard .space-y-4');
            if (!recentContainer) return;

            const recentSLAs = demoData.slas.slice(0, 3); // Show first 3 SLAs
            recentContainer.innerHTML = recentSLAs.map(sla => `
                <div class="flex items-center justify-between py-3 border-b border-color">
                    <div class="flex-1">
                        <h4 class="text-sm font-medium text-primary-color cursor-pointer hover:text-primary" style="color: var(--color-text-primary)" onclick="showSLADetail('${sla.id}')">${sla.slaName}</h4>
                        <p class="text-xs text-muted">${sla.slaType.toUpperCase()}</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-16 rounded-full h-2" style="background-color: var(--color-gray-light)">
                                <div class="${getProgressBarClass(sla.status)} h-2 rounded-full progress-bar" style="width: ${sla.progress}%"></div>
                            </div>
                            <span class="text-sm text-secondary-color">${sla.progress}%</span>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadgeClass(sla.status)}">${sla.status.replace('-', ' ')}</span>
                    </div>
                </div>
            `).join('');
        }

        // Navigation and Section Management
        function goBack() {
            // Go back to the previous section (usually dashboard or list)
            if (isEditMode) {
                // If in edit mode, go back to the detail page of the SLA being edited
                if (editingSlaId) {
                    showSLADetail(editingSlaId);
                } else {
                    showSection('list');
                }
            } else {
                // If in create mode, go back to dashboard
                showSection('dashboard');
            }
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Update navigation active state
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('link-primary', 'font-medium');
                btn.classList.add('text-secondary-color');
            });
            
            // Only update nav button if it exists (since we removed some)
            const activeBtn = document.getElementById(`nav-${sectionName}`);
            if (activeBtn) {
                activeBtn.classList.remove('text-secondary-color');
                activeBtn.classList.add('link-primary', 'font-medium');
            }

            // Render section-specific content
            if (sectionName === 'list') {
                showTaskSelection();
                updateTaskCounts();
            } else if (sectionName === 'dashboard') {
                updateDashboardStats();
                updateDashboardRecentSLAs();
            }
            
            // Initialize create section with a fresh tab when entering
            if (sectionName === 'create' && !isEditMode) {
                // Only reset if there are no existing tabs or forms
                const existingForms = document.querySelectorAll('.sla-form-container');
                if (existingForms.length === 0) {
                    setTimeout(() => {
                        if (slaCounter === 0) {
                            addNewSLA();
                        }
                    }, 100);
                }
            }
        }

        // Task selection and filtering functions
        function showTaskSelection() {
            if (domCache.taskSelectionView && domCache.filteredSlaView) {
                domCache.taskSelectionView.style.display = 'block';
                domCache.filteredSlaView.style.display = 'none';
            } else {
                // Fallback if cache not initialized
                const taskView = document.getElementById('task-selection-view');
                const filteredView = document.getElementById('filtered-sla-view');
                if (taskView) taskView.style.display = 'block';
                if (filteredView) filteredView.style.display = 'none';
            }
        }
        
        function showTaskSLAs(taskName) {
            if (domCache.taskSelectionView && domCache.filteredSlaView) {
                domCache.taskSelectionView.style.display = 'none';
                domCache.filteredSlaView.style.display = 'block';
            } else {
                // Fallback if cache not initialized
                const taskView = document.getElementById('task-selection-view');
                const filteredView = document.getElementById('filtered-sla-view');
                if (taskView) taskView.style.display = 'none';
                if (filteredView) filteredView.style.display = 'block';
            }
            
            const titleElement = document.getElementById('filtered-task-title');
            if (titleElement) {
                titleElement.textContent = `${taskName} SLAs`;
            }
            
            // Filter and display SLAs for the selected task
            renderFilteredSLAs(taskName);
        }
        
        function updateTaskCounts() {
            const slas = demoData.slas || [];
            const taskCounts = {};
            
            // Initialize counts
            for (let i = 1; i <= 9; i++) {
                taskCounts[`Task ${i}`] = 0;
            }
            
            // Count SLAs per task
            slas.forEach(sla => {
                if (taskCounts.hasOwnProperty(sla.taskName)) {
                    taskCounts[sla.taskName]++;
                }
            });
            
            // Update the UI
            for (let i = 1; i <= 9; i++) {
                const taskKey = `Task ${i}`;
                const count = taskCounts[taskKey];
                const countElement = document.getElementById(`task-${i}-count`);
                if (countElement) {
                    countElement.textContent = `${count} SLA${count !== 1 ? 's' : ''}`;
                }
            }
        }
        
        function renderFilteredSLAs(taskName) {
            const slas = demoData.slas || [];
            const filteredSLAs = slas.filter(sla => sla.taskName === taskName);
            const tbody = document.getElementById('filtered-sla-table-body');
            
            if (!tbody) {
                console.error('Table body not found');
                return;
            }
            
            tbody.innerHTML = '';
            
            if (filteredSLAs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-muted">
                            No SLAs found for ${taskName}
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredSLAs.forEach(sla => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => viewSLADetails(sla.id);
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-primary-color">${sla.slaName}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${sla.slaType}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">
                        ${sla.teamName}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadgeClass(sla.status)}">
                            ${sla.status.charAt(0).toUpperCase() + sla.status.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                <div class="h-2 rounded-full ${getProgressBarClass(sla.status)}" style="width: ${sla.progress}%"></div>
                            </div>
                            <span class="text-sm text-muted">${sla.progress}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">
                        ${formatDate(sla.endDate)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="event.stopPropagation(); viewSLADetails('${sla.id}')" class="text-primary-color hover:text-secondary-color mr-3">View</button>
                        <button onclick="event.stopPropagation(); editSLA('${sla.id}')" class="text-secondary-color hover:text-primary-color">Edit</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function showSLADetail(slaId) {
            currentSlaId = slaId;
            renderSLADetail(slaId);
            showSection('detail');
        }

        // Alias function for consistency across the application
        function viewSLADetails(slaId) {
            showSLADetail(slaId);
        }

        function deleteSLA(slaId) {
            if (confirm('Are you sure you want to delete this SLA?')) {
                const index = demoData.slas.findIndex(sla => sla.id === slaId);
                if (index > -1) {
                    demoData.slas.splice(index, 1);
                    demoData.slaCount = demoData.slas.length;
                    renderSLAList();
                    showNotification('SLA deleted successfully!');
                }
            }
        }

        // SLA Management (rest of the functions remain the same)
        function addNewSLA() {
            slaCounter++;
            const slaContainer = document.getElementById('slaContainer');
            const tabsContainer = document.getElementById('slaTabs');
            const addButton = tabsContainer.querySelector('button[onclick="addNewSLA()"]');
            
            // Create tab
            const tabHtml = `
                <button type="button" onclick="switchToTab(${slaCounter})" 
                        class="sla-tab"
                        id="tab-${slaCounter}">
                    <span>SLA ${slaCounter}</span>
                    <span onclick="event.stopPropagation(); removeSLATab(${slaCounter})" class="tab-close-btn">√ó</span>
                </button>
            `;
            
            // Insert tab before the Add button
            addButton.insertAdjacentHTML('beforebegin', tabHtml);
            
            // Create form container
            const slaHtml = createSLAForm(slaCounter);
            slaContainer.insertAdjacentHTML('beforeend', slaHtml);
            
            // Switch to the new tab
            switchToTab(slaCounter);
            
            // Initialize as invalid (no fields filled yet)
            updateTabValidation(slaCounter);
            
            // Show submit button at the top if this is the first SLA
            const topSubmitButton = document.getElementById('topSubmitButton');
            if (topSubmitButton) {
                topSubmitButton.style.display = 'block';
            }
        }

        function switchToTab(id) {
            // Hide all form containers
            document.querySelectorAll('.sla-form-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.sla-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected form container
            const targetContainer = document.getElementById(`sla-container-${id}`);
            if (targetContainer) {
                targetContainer.classList.add('active');
            }
            
            // Add active class to selected tab
            const targetTab = document.getElementById(`tab-${id}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        function removeSLATab(id) {
            if (confirm('Are you sure you want to remove this SLA?')) {
                // Remove the tab
                const tab = document.getElementById(`tab-${id}`);
                if (tab) {
                    tab.remove();
                }
                
                // Remove the form container
                const container = document.getElementById(`sla-container-${id}`);
                if (container) {
                    container.remove();
                }
                
                // Switch to another tab if this was the active one
                const remainingTabs = document.querySelectorAll('.sla-tab');
                if (remainingTabs.length > 0) {
                    const lastTab = remainingTabs[remainingTabs.length - 1];
                    const tabId = lastTab.id.replace('tab-', '');
                    switchToTab(tabId);
                } else {
                    // Hide submit button if no tabs remain
                    const topSubmitButton = document.getElementById('topSubmitButton');
                    if (topSubmitButton) {
                        topSubmitButton.style.display = 'none';
                    }
                }
            }
        }

        function updateTabTitle(id, title) {
            const tab = document.getElementById(`tab-${id}`);
            if (tab) {
                const titleSpan = tab.querySelector('span');
                if (titleSpan) {
                    titleSpan.textContent = title || `SLA ${id}`;
                }
            }
        }

        // Add event listener for SLA name changes to update tab titles
        function attachTabTitleListeners() {
            document.addEventListener('input', function(e) {
                if (e.target.id && e.target.id.startsWith('slaName-')) {
                    const id = e.target.id.replace('slaName-', '');
                    const title = e.target.value.trim() || `SLA ${id}`;
                    updateTabTitle(id, title);
                }
                
                // Update tab validation status on any input change
                if (e.target.closest('.sla-form-container')) {
                    const container = e.target.closest('.sla-form-container');
                    const tabId = container.id.replace('sla-container-', '');
                    updateTabValidation(tabId);
                }
            });
            
            // Also listen for select changes
            document.addEventListener('change', function(e) {
                if (e.target.closest('.sla-form-container')) {
                    const container = e.target.closest('.sla-form-container');
                    const tabId = container.id.replace('sla-container-', '');
                    updateTabValidation(tabId);
                }
            });
        }

        function updateTabValidation(tabId) {
            const tab = document.getElementById(`tab-${tabId}`);
            const container = document.getElementById(`sla-container-${tabId}`);
            
            if (!tab || !container) return;
            
            const isValid = validateSLAForm(tabId);
            
            // Remove existing validation classes
            tab.classList.remove('valid', 'invalid');
            
            // Add appropriate validation class
            if (isValid) {
                tab.classList.add('valid');
            } else {
                tab.classList.add('invalid');
            }
        }

        function validateSLAForm(tabId) {
            const requiredFields = [
                `slaName-${tabId}`,
                `teamName-${tabId}`,
                `description-${tabId}`,
                `taskName-${tabId}`,
                `slaType-${tabId}`,
                `startDate-${tabId}`
            ];
            
            return requiredFields.every(fieldId => {
                const field = document.getElementById(fieldId);
                return field && field.value && field.value.trim() !== '';
            });
        }

        function createSLAForm(id) {
            return `
                <div id="sla-container-${id}" class="sla-form-container">
                    <div id="sla-${id}" class="sla-card bg-gray-50 rounded-lg p-6" style="background-color: var(--color-gray-light)">
                        <!-- Basic Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="slaName-${id}" class="block text-sm font-medium text-primary-color mb-2">SLA Name *</label>
                                <input type="text" id="slaName-${id}" name="slaName" required
                                       class="w-full px-3 py-2 border border-color rounded-md">
                            </div>
                        </div>

                        <div class="mb-6">
                            <label for="description-${id}" class="block text-sm font-medium text-primary-color mb-2">Description *</label>
                            <textarea id="description-${id}" name="description" rows="2" required
                                      class="w-full px-3 py-2 border border-color rounded-md"
                                      placeholder="Describe the SLA requirements and objectives..."></textarea>
                        </div>

                        <!-- Task and Team Selection -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="taskName-${id}" class="block text-sm font-medium text-primary-color mb-2">Task Name *</label>
                                <select id="taskName-${id}" name="taskName" required
                                        class="w-full px-3 py-2 border border-color rounded-md"
                                        onchange="updateTeamOptions(${id}, this.value)">
                                    <option value="">Select Task</option>
                                    <option value="Task 1">Task 1</option>
                                    <option value="Task 2">Task 2</option>
                                    <option value="Task 3">Task 3</option>
                                    <option value="Task 4">Task 4</option>
                                    <option value="Task 5">Task 5</option>
                                    <option value="Task 6">Task 6</option>
                                    <option value="Task 7">Task 7</option>
                                    <option value="Task 8">Task 8</option>
                                    <option value="Task 9">Task 9</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="teamName-${id}" class="block text-sm font-medium text-primary-color mb-2">Team Name *</label>
                                <select id="teamName-${id}" name="teamName" required
                                        class="w-full px-3 py-2 border border-color rounded-md">
                                    <option value="">Select Team</option>
                                </select>
                            </div>
                        </div>

                        <!-- SLA Type Selection -->
                        <div class="mb-6">
                            <label for="slaType-${id}" class="block text-sm font-medium text-primary-color mb-2">SLA Type *</label>
                            <select id="slaType-${id}" name="slaType" required
                                    class="w-full px-3 py-2 border border-color rounded-md"
                                    onchange="showSLAConfig(${id}, this.value)">
                                <option value="">Select SLA Type</option>
                                <option value="quantity">Quantity</option>
                                <option value="percentage">Percentage</option>
                                <option value="timeliness">Timeliness</option>
                                <option value="availability">Availability</option>
                                <option value="compliance">Compliance</option>
                            </select>
                        </div>

                        <!-- Dynamic SLA Configuration -->
                        <div id="slaConfig-${id}" class="hidden mb-6">
                            <!-- Quantity -->
                            <div id="quantityConfig-${id}" class="sla-config-section hidden">
                                <h4 class="text-md font-medium text-primary-color mb-3">Quantity Configuration</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Action</label>
                                        <input type="text" id="quantityAction-${id}" placeholder="e.g., reviewing, supporting"
                                               class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Unit</label>
                                        <input type="text" id="quantityUnit-${id}" placeholder="e.g., requests, documents"
                                               class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Target Type</label>
                                        <div class="flex items-center space-x-3">
                                            <span class="text-sm">Single</span>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="quantityRange-${id}" onchange="toggleQuantityRange(${id})">
                                                <span class="slider"></span>
                                            </label>
                                            <span class="text-sm">Range</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="quantityTarget-${id}" class="grid grid-cols-1 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Target Value</label>
                                        <input type="number" id="quantityTargetValue-${id}" class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                </div>
                                <div id="childSLAs-${id}" class="mt-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h5 class="text-sm font-medium text-primary-color">Child SLAs</h5>
                                        <button type="button" onclick="addChildSLA(${id})" class="px-3 py-1 text-sm rounded-md border" style="color: var(--color-primary); border-color: var(--color-primary)">Add Child SLA</button>
                                    </div>
                                    <div id="childSLAContainer-${id}" class="space-y-3">
                                        <!-- Child SLAs will be added here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Percentage -->
                            <div id="percentageConfig-${id}" class="sla-config-section hidden">
                                <h4 class="text-md font-medium text-primary-color mb-3">Percentage Configuration</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Target Type</label>
                                        <div class="flex items-center space-x-3">
                                            <span class="text-sm">Single</span>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="percentageRange-${id}" onchange="togglePercentageRange(${id})">
                                                <span class="slider"></span>
                                            </label>
                                            <span class="text-sm">Range</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="percentageTarget-${id}" class="grid grid-cols-1 gap-4 mt-4">
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Target Percentage</label>
                                        <input type="number" id="percentageTargetValue-${id}" min="0" max="100" step="0.01" class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                </div>
                            </div>

                            <!-- Timeliness -->
                            <div id="timelinessConfig-${id}" class="sla-config-section hidden">
                                <h4 class="text-md font-medium text-primary-color mb-3">Timeliness Configuration</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Target Value</label>
                                        <input type="number" id="timelinessTarget-${id}" step="0.01" class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Cadence</label>
                                        <select id="timelinessCadence-${id}" class="w-full px-3 py-2 border border-color rounded-md">
                                            <option value="">Select Cadence</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="quarterly">Quarterly</option>
                                            <option value="yearly">Yearly</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Availability -->
                            <div id="availabilityConfig-${id}" class="sla-config-section hidden">
                                <h4 class="text-md font-medium text-primary-color mb-3">Availability Configuration</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">Start Time</label>
                                        <input type="time" id="availabilityStartTime-${id}" class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-primary-color mb-2">End Time</label>
                                        <input type="time" id="availabilityEndTime-${id}" class="w-full px-3 py-2 border border-color rounded-md">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-primary-color mb-2">Days of Week</label>
                                    <div class="grid grid-cols-7 gap-2">
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="monday" class="mr-1"> Mon</label>
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="tuesday" class="mr-1"> Tue</label>
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="wednesday" class="mr-1"> Wed</label>
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="thursday" class="mr-1"> Thu</label>
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="friday" class="mr-1"> Fri</label>
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="saturday" class="mr-1"> Sat</label>
                                        <label class="flex items-center text-sm"><input type="checkbox" name="availabilityDays-${id}" value="sunday" class="mr-1"> Sun</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Compliance -->
                            <div id="complianceConfig-${id}" class="sla-config-section hidden">
                                <h4 class="text-md font-medium text-primary-color mb-3">Compliance Configuration</h4>
                                <div>
                                    <label class="block text-sm font-medium text-primary-color mb-2">Target Compliance</label>
                                    <select id="complianceTarget-${id}" class="w-full px-3 py-2 border border-color rounded-md">
                                        <option value="">Select Target</option>
                                        <option value="yes">Yes</option>
                                        <option value="no">No</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Time Period -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="startDate-${id}" class="block text-sm font-medium text-primary-color mb-2">Start Date *</label>
                                <input type="date" id="startDate-${id}" name="startDate" required
                                       class="w-full px-3 py-2 border border-color rounded-md">
                            </div>
                            
                            <div>
                                <label for="endDate-${id}" class="block text-sm font-medium text-primary-color mb-2">End Date</label>
                                <input type="date" id="endDate-${id}" name="endDate"
                                       class="w-full px-3 py-2 border border-color rounded-md">
                            </div>
                        </div>

                        <!-- Notification Settings -->
                        <div>
                            <h4 class="text-md font-medium text-primary-color mb-3">Notification Settings</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" id="notifyOnRisk-${id}" name="notifyOnRisk" class="mr-2">
                                    <span class="text-sm text-primary-color">Notify when SLA is at risk</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="notifyOnMiss-${id}" name="notifyOnMiss" class="mr-2">
                                    <span class="text-sm text-primary-color">Notify when SLA is missed</span>
                                </label>
                                <div>
                                    <label for="notificationEmail-${id}" class="block text-sm font-medium text-primary-color mb-2">Notification Email</label>
                                    <input type="email" id="notificationEmail-${id}" name="notificationEmail"
                                           class="w-full px-3 py-2 border border-color rounded-md">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            `;
        }

        function submitSLAs() {
            // Collect all SLA data
            const slaData = collectSLAData();
            
            if (slaData.length === 0) {
                showNotification('Please create at least one SLA', 'error');
                return;
            }

            // Validate all SLAs have required fields
            const slaContainers = document.querySelectorAll('.sla-form-container');
            let hasInvalidSLAs = false;
            let invalidTabIds = [];

            slaContainers.forEach((container) => {
                const tabId = container.id.replace('sla-container-', '');
                if (!validateSLAForm(tabId)) {
                    hasInvalidSLAs = true;
                    invalidTabIds.push(tabId);
                }
            });

            if (hasInvalidSLAs) {
                showNotification('Please complete all required fields in all SLA tabs before submitting', 'error');
                
                // Highlight invalid tabs
                invalidTabIds.forEach(tabId => {
                    updateTabValidation(tabId);
                });
                
                // Switch to first invalid tab
                if (invalidTabIds.length > 0) {
                    switchToTab(invalidTabIds[0]);
                }
                return;
            }

            if (isEditMode && editingSlaId) {
                // Update existing SLA
                const slaIndex = demoData.slas.findIndex(s => s.id === editingSlaId);
                if (slaIndex > -1) {
                    // Keep the original ID and status/progress
                    const originalSla = demoData.slas[slaIndex];
                    const updatedSla = {
                        ...slaData[0],
                        id: editingSlaId,
                        status: originalSla.status,
                        progress: originalSla.progress,
                        currentValue: originalSla.currentValue,
                        metrics: originalSla.metrics,
                        activityLog: [
                            {
                                type: "info",
                                message: "SLA updated",
                                timestamp: "Just now"
                            },
                            ...(originalSla.activityLog || [])
                        ]
                    };
                    
                    demoData.slas[slaIndex] = updatedSla;
                    showNotification('SLA updated successfully!');
                    
                    // Reset edit mode
                    isEditMode = false;
                    editingSlaId = null;
                    
                    // Update header and button back to create mode
                    const header = document.querySelector('#create h2');
                    const topSubmitButton = document.getElementById('topSubmitButton');
                    if (header) header.textContent = 'Create SLAs';
                    if (topSubmitButton) {
                        topSubmitButton.textContent = 'Create All SLAs';
                        topSubmitButton.style.display = 'none';
                    }
                    
                    setTimeout(() => {
                        showSLADetail(updatedSla.id);
                    }, 1000);
                    
                    return;
                }
            }

            // Original create logic
            const payload = {
                timestamp: new Date().toISOString(),
                slaCount: slaData.length,
                slas: slaData
            };

            console.log('SLA Data to be sent to backend:', JSON.stringify(payload, null, 2));
            showJsonModal(payload);
            
            // Show success message and redirect
            showNotification('All SLAs processed successfully!');
            setTimeout(() => {
                showSection('list');
            }, 2000);
        }

        function collectSLAData() {
            const slaDataArray = [];
            
            // Determine if we're in edit mode for a single SLA
            if (isEditMode && editingSlaId) {
                // In edit mode, we should only have one active form
                const activeContainer = document.querySelector('.sla-form-container.active');
                if (activeContainer) {
                    const slaData = extractSLADataFromContainer(activeContainer);
                    if (slaData) {
                        slaData.id = editingSlaId;
                        slaDataArray.push(slaData);
                    }
                }
            } else {
                // Collect data from all SLA forms in their containers
                const slaContainers = document.querySelectorAll('.sla-form-container');
                
                slaContainers.forEach((container, index) => {
                    const slaData = extractSLADataFromContainer(container);
                    if (slaData) {
                        slaData.id = Date.now() + '_' + (index + 1); // Generate unique ID
                        slaDataArray.push(slaData);
                    }
                });
            }
            
            return slaDataArray;
        }

        function extractSLADataFromContainer(container) {
            if (!container) return null;
            
            const tabId = container.id.replace('sla-container-', '');
            const slaData = {};
            
            // Extract basic form fields
            const getFieldValue = (fieldName) => {
                const field = container.querySelector(`#${fieldName}-${tabId}`);
                return field ? field.value.trim() : '';
            };
            
            const getCheckboxValue = (fieldName) => {
                const field = container.querySelector(`#${fieldName}-${tabId}`);
                return field ? field.checked : false;
            };
            
            // Collect basic information
            slaData.slaName = getFieldValue('slaName');
            slaData.teamName = getFieldValue('teamName');
            slaData.description = getFieldValue('description');
            slaData.taskName = getFieldValue('taskName');
            slaData.slaType = getFieldValue('slaType');
            slaData.startDate = getFieldValue('startDate');
            slaData.endDate = getFieldValue('endDate');
            
            // Collect notification settings
            slaData.notifications = {
                onRisk: getCheckboxValue('notifyOnRisk'),
                onMiss: getCheckboxValue('notifyOnMiss'),
                email: getFieldValue('notificationEmail')
            };
            
            // Skip if required fields are empty
            if (!slaData.slaName || !slaData.teamName || !slaData.description || 
                !slaData.taskName || !slaData.slaType || !slaData.startDate) {
                return null;
            }
            
            // Add type-specific configuration
            slaData.configuration = {};
            
            switch (slaData.slaType) {
                case 'quantity':
                    slaData.configuration.action = getFieldValue('quantityAction');
                    slaData.configuration.unit = getFieldValue('quantityUnit');
                    
                    const quantityRange = getCheckboxValue('quantityRange');
                    slaData.configuration.targetType = quantityRange ? 'range' : 'single';
                    
                    if (quantityRange) {
                        const minField = container.querySelector(`#quantityTarget-${tabId} input[placeholder*="Minimum"]`);
                        const maxField = container.querySelector(`#quantityTarget-${tabId} input[placeholder*="Maximum"]`);
                        slaData.configuration.target = {
                            min: minField ? parseFloat(minField.value) || 0 : 0,
                            max: maxField ? parseFloat(maxField.value) || 0 : 0
                        };
                    } else {
                        const targetValue = getFieldValue('quantityTargetValue');
                        slaData.configuration.target = targetValue ? parseFloat(targetValue) : 0;
                    }
                    break;
                    
                case 'percentage':
                    const percentageRange = getCheckboxValue('percentageRange');
                    slaData.configuration.targetType = percentageRange ? 'range' : 'single';
                    
                    if (percentageRange) {
                        const minField = container.querySelector(`#percentageTarget-${tabId} input[placeholder*="Minimum"]`);
                        const maxField = container.querySelector(`#percentageTarget-${tabId} input[placeholder*="Maximum"]`);
                        slaData.configuration.target = {
                            min: minField ? parseFloat(minField.value) || 0 : 0,
                            max: maxField ? parseFloat(maxField.value) || 0 : 0
                        };
                    } else {
                        const targetValue = getFieldValue('percentageTargetValue');
                        slaData.configuration.target = targetValue ? parseFloat(targetValue) : 0;
                    }
                    break;
                    
                case 'timeliness':
                    slaData.configuration.targetValue = parseFloat(getFieldValue('timelinessTarget')) || 0;
                    slaData.configuration.cadence = getFieldValue('timelinessCadence');
                    break;
                    
                case 'availability':
                    slaData.configuration.startTime = getFieldValue('availabilityStartTime');
                    slaData.configuration.endTime = getFieldValue('availabilityEndTime');
                    
                    const dayCheckboxes = container.querySelectorAll(`input[name="availabilityDays-${tabId}"]:checked`);
                    slaData.configuration.daysOfWeek = Array.from(dayCheckboxes).map(cb => cb.value);
                    break;
                    
                case 'compliance':
                    const complianceValue = getFieldValue('complianceTarget');
                    slaData.configuration.targetValue = complianceValue === 'yes' ? true : 
                                                       complianceValue === 'no' ? false : null;
                    break;
            }
            
            return slaData;
        }

        // Task and Team mapping configuration with validation
        function updateTeamOptions(id, selectedTask) {
            if (!id || !selectedTask) {
                console.warn('updateTeamOptions: Invalid parameters', { id, selectedTask });
                return;
            }
            
            const teamSelect = document.getElementById(`teamName-${id}`);
            if (!teamSelect) {
                console.error(`Team select element not found for ID: teamName-${id}`);
                return;
            }
            
            // Clear existing options
            teamSelect.innerHTML = '<option value="">Select Team</option>';
            
            const taskTeamMapping = {
                'Task 1': ['Program Management Team'],
                'Task 2': ['APM Team', 'TW/Template Team', 'Cost Team'],
                'Task 3': ['PPM Team'],
                'Task 4': ['Technical Evaluation Team'],
                'Task 5': ['Training Support Team'],
                'Task 6': ['Business Intelligence Team'],
                'Task 7': ['Operational Support Team'],
                'Task 8': ['Quality Support Team'],
                'Task 9': ['Communication Team']
            };
            
            if (selectedTask && taskTeamMapping[selectedTask]) {
                const teams = taskTeamMapping[selectedTask];
                
                teams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team;
                    option.textContent = team;
                    teamSelect.appendChild(option);
                });
                
                // Auto-select if only one team option (Tasks 1, 3-9)
                if (teams.length === 1) {
                    teamSelect.value = teams[0];
                    // Trigger change event for any dependent functionality
                    teamSelect.dispatchEvent(new Event('change'));
                }
            }
        }

        function showSLAConfig(id, type) {
            const slaConfigSection = document.getElementById(`slaConfig-${id}`);
            const allConfigs = document.querySelectorAll(`#sla-${id} .sla-config-section`);
            
            // Check if elements exist before accessing them
            if (!slaConfigSection) {
                console.warn(`SLA config section not found for ID: ${id}`);
                return;
            }
            
            // Hide all config sections
            allConfigs.forEach(config => config.classList.add('hidden'));
            
            if (type) {
                slaConfigSection.classList.remove('hidden');
                const targetConfig = document.getElementById(`${type}Config-${id}`);
                if (targetConfig) {
                    targetConfig.classList.remove('hidden');
                }
            } else {
                slaConfigSection.classList.add('hidden');
            }
        }

function toggleQuantityRange(id) {
    const checkbox = document.getElementById(`quantityRange-${id}`);
    const targetDiv = document.getElementById(`quantityTarget-${id}`);
    
    if (!checkbox || !targetDiv) return;
    
    const isRange = checkbox.checked;
    
    if (isRange) {
        targetDiv.innerHTML = `
            <div>
                <label class="block text-sm font-medium text-primary-color mb-2">Minimum Value</label>
                <input type="number" placeholder="Minimum Value" class="w-full px-3 py-2 border border-color rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium text-primary-color mb-2">Maximum Value</label>
                <input type="number" placeholder="Maximum Value" class="w-full px-3 py-2 border border-color rounded-md">
            </div>
        `;
        targetDiv.className = 'grid grid-cols-1 md:grid-cols-2 gap-4 mb-4';
    } else {
        targetDiv.innerHTML = `
            <div>
                <label class="block text-sm font-medium text-primary-color mb-2">Target Value</label>
                <input type="number" id="quantityTargetValue-${id}" class="w-full px-3 py-2 border border-color rounded-md">
            </div>
        `;
        targetDiv.className = 'grid grid-cols-1 gap-4 mb-4';
    }
}

function togglePercentageRange(id) {
    const checkbox = document.getElementById(`percentageRange-${id}`);
    const targetDiv = document.getElementById(`percentageTarget-${id}`);
    
    if (!checkbox || !targetDiv) return;
    
    const isRange = checkbox.checked;
    
    if (isRange) {
        targetDiv.innerHTML = `
            <div>
                <label class="block text-sm font-medium text-primary-color mb-2">Minimum Percentage</label>
                <input type="number" placeholder="Minimum Percentage" min="0" max="100" step="0.01" class="w-full px-3 py-2 border border-color rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium text-primary-color mb-2">Maximum Percentage</label>
                <input type="number" placeholder="Maximum Percentage" min="0" max="100" step="0.01" class="w-full px-3 py-2 border border-color rounded-md">
            </div>
        `;
        targetDiv.className = 'grid grid-cols-1 md:grid-cols-2 gap-4 mt-4';
    } else {
        targetDiv.innerHTML = `
            <div>
                <label class="block text-sm font-medium text-primary-color mb-2">Target Percentage</label>
                <input type="number" id="percentageTargetValue-${id}" min="0" max="100" step="0.01" class="w-full px-3 py-2 border border-color rounded-md">
            </div>
        `;
        targetDiv.className = 'grid grid-cols-1 gap-4 mt-4';
    }
}

        function addChildSLA(parentId) {
            const container = document.getElementById(`childSLAContainer-${parentId}`);
            const childId = `${parentId}-${Date.now()}`;
            const childHtml = `
                <div id="childSLA-${childId}" class="bg-surface p-4 rounded-md border border-color">
                    <div class="flex items-center justify-between mb-3">
                        <h6 class="text-sm font-medium text-primary-color">Child SLA</h6>
                        <button type="button" onclick="removeChildSLA('${childId}')" class="text-xs" style="color: var(--color-status-error)">Remove</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-primary-color mb-1">Target Value</label>
                            <input type="number" class="w-full px-2 py-1 border border-color rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-primary-color mb-1">Unit Description</label>
                            <input type="text" placeholder="e.g., documents per package" class="w-full px-2 py-1 border border-color rounded text-sm">
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', childHtml);
        }

        function removeChildSLA(childId) {
            const childElement = document.getElementById(`childSLA-${childId}`);
            if (childElement) {
                childElement.remove();
            }
        }

        function editSLA(id) {
            // Find the SLA from our data
            const sla = demoData.slas.find(s => s.id === id);
            if (!sla) {
                console.error('SLA not found:', id);
                return;
            }
            
            // Set edit mode
            isEditMode = true;
            editingSlaId = id;
            
            // Update header and button text
            const header = document.querySelector('#create h2');
            const topSubmitButton = document.getElementById('topSubmitButton');
            if (header) header.textContent = 'Edit SLA';
            if (topSubmitButton) {
                topSubmitButton.textContent = 'Update SLA';
                topSubmitButton.style.display = 'block';
            }
            
            // Switch to create section
            showSection('create');
            
            // Clear existing forms and add edit form
            const slaContainer = document.getElementById('slaContainer');
            const tabsContainer = document.getElementById('slaTabs');
            
            // Clear containers
            slaContainer.innerHTML = '';
            const addButton = tabsContainer.querySelector('button[onclick="addNewSLA()"]');
            tabsContainer.innerHTML = '';
            tabsContainer.appendChild(addButton);
            
            // Reset counter and add edit form
            slaCounter = 0;
            addNewSLA();
            
            // Wait for form to be created then populate it
            setTimeout(() => {
                populateFormWithSLA(slaCounter, sla);
                updateTabTitle(slaCounter, sla.slaName || 'Edit SLA');
                
                // Update validation status for the edit tab
                setTimeout(() => {
                    updateTabValidation(slaCounter);
                }, 200);
            }, 100);
        }

        function populateFormWithSLA(formId, sla) {
            const container = document.querySelector(`[data-tab-id="${formId}"]`);
            if (!container) return;
            
            // Basic fields
            const setFieldValue = (name, value) => {
                const field = container.querySelector(`[name="${name}"]`);
                if (field) {
                    if (field.type === 'checkbox') {
                        field.checked = value;
                    } else {
                        field.value = value || '';
                    }
                }
            };
            
            setFieldValue('slaName', sla.slaName);
            setFieldValue('teamName', sla.teamName);
            setFieldValue('description', sla.description);
            setFieldValue('taskName', sla.taskName);
            setFieldValue('slaType', sla.slaType);
            setFieldValue('startDate', sla.startDate);
            setFieldValue('endDate', sla.endDate);
            setFieldValue('notifyOnRisk', sla.notifications?.onRisk);
            setFieldValue('notifyOnMiss', sla.notifications?.onMiss);
            setFieldValue('notificationEmail', sla.notifications?.email);
            
            // Trigger SLA type configuration if needed
            if (sla.slaType) {
                const typeField = container.querySelector('[name="slaType"]');
                if (typeField) {
                    typeField.dispatchEvent(new Event('change'));
                }
            }
        }

        function removeSLA(id) {
            removeSLATab(id);
        }

        // Modal Management
        function showUpdateModal() {
            const sla = demoData.slas.find(s => s.id === currentSlaId);
            if (sla) {
                document.getElementById('currentValue').value = sla.currentValue;
            }
            document.getElementById('updateModal').classList.remove('hidden');
        }

        function hideUpdateModal() {
            document.getElementById('updateModal').classList.add('hidden');
        }

function saveUpdate() {
    const currentValue = document.getElementById('currentValue').value;
    const notes = document.getElementById('updateNotes').value;
    
    if (!currentValue || isNaN(currentValue)) {
        showNotification('Please enter a valid number', 'error');
        return;
    }
    
    // Update demo data
    const sla = demoData.slas.find(s => s.id === currentSlaId);
    if (sla) {
        const oldValue = sla.currentValue;
        sla.currentValue = parseFloat(currentValue);
        
        // Recalculate progress based on new value
        const newProgress = calculateProgress(sla);
        sla.progress = newProgress;
        
        // Update status based on new progress
        if (sla.configuration.targetType === 'range') {
            const min = sla.configuration.target.min || 0;
            if (sla.currentValue >= min) {
                sla.status = 'met';
            } else if (sla.currentValue >= min * 0.8) {
                sla.status = 'at-risk';
            } else {
                sla.status = 'missed';
            }
        } else {
            if (newProgress >= 100) {
                sla.status = 'met';
            } else if (newProgress >= 80) {
                sla.status = 'at-risk';
            } else {
                sla.status = 'missed';
            }
        }
        
        // Add to activity log
        const notesPart = notes ? ` - ${notes}` : '';
        sla.activityLog.unshift({
            type: "info",
            message: `Progress updated - Current value: ${currentValue} (was ${oldValue})${notesPart}`,
            timestamp: "Just now"
        });
        
        // Re-render the detail page with updated data
        renderSLADetail(currentSlaId);
        
        // Update dashboard and list if needed
        updateDashboardStats();
        updateDashboardRecentSLAs();
    }
    
    showNotification('Progress updated successfully!');
    hideUpdateModal();
    
    // Reset form
    document.getElementById('updateNotes').value = '';
}

        // Notification System - Improved with security and performance
        function showNotification(message, type = 'success') {
            const notification = domCache.notification || document.getElementById('notification');
            if (!notification) return;
            
            // Sanitize message to prevent XSS
            notification.textContent = String(message).slice(0, 200); // Limit length
            
            const bgColor = type === 'success' ? 'var(--color-status-success)' : 'var(--color-status-error)';
            notification.style.backgroundColor = bgColor;
            notification.style.color = 'white';
            notification.classList.remove('hidden');
            
            // Clear any existing timeout
            if (notification.timeoutId) {
                clearTimeout(notification.timeoutId);
            }
            
            // Auto-hide after 3 seconds
            notification.timeoutId = setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

// Backend configuration
const BACKEND_CONFIG = {
    BASE_URL: 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE',
    GET_SLAS_ENDPOINT: 'YOUR_WEB_APP_URL?action=getAllSLAs'
};

/**
 * Load SLAs from backend
 */
async function loadSLAsFromBackend() {
    try {
        showNotification('Loading SLAs from backend...', 'info');
        
        const response = await fetch(BACKEND_CONFIG.GET_SLAS_ENDPOINT, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
            // Replace demo data with backend data
            if (result.data && result.data.slas) {
                Object.assign(demoData, result.data);
                
                // Update UI
                updateDashboardStats();
                updateDashboardRecentSLAs();
                
                showNotification(`Successfully loaded ${result.data.slaCount} SLAs from backend!`);
                
                console.log('Loaded SLAs:', result.data);
                return true;
            } else {
                showNotification('No SLAs found in backend', 'warning');
                return false;
            }
        } else {
            showNotification(`Backend error: ${result.message}`, 'error');
            return false;
        }
        
    } catch (error) {
        console.error('Error loading SLAs from backend:', error);
        showNotification('Failed to load SLAs from backend. Using demo data.', 'error');
        return false;
    }
}

/**
 * Refresh data from backend
 */
async function refreshDataFromBackend() {
    const success = await loadSLAsFromBackend();
    if (success) {
        // Re-render current section
        const currentSection = document.querySelector('.section.active')?.id;
        if (currentSection) {
            showSection(currentSection);
        }
    }
}

/**
 * Add a refresh button to the interface
 */
function addRefreshButton() {
    // Add to dashboard
    const dashboardHeader = document.querySelector('#dashboard h2')?.parentElement;
    if (dashboardHeader) {
        const refreshBtn = document.createElement('button');
        refreshBtn.className = 'px-4 py-2 rounded-md btn-secondary';
        refreshBtn.innerHTML = 'üîÑ Refresh Data';
        refreshBtn.onclick = refreshDataFromBackend;
        dashboardHeader.appendChild(refreshBtn);
    }
    
    // Add to list view
    const listHeader = document.querySelector('#list .flex.justify-between');
    if (listHeader) {
        const refreshBtn = document.createElement('button');
        refreshBtn.className = 'px-4 py-2 rounded-md btn-secondary';
        refreshBtn.innerHTML = 'üîÑ Refresh';
        refreshBtn.onclick = refreshDataFromBackend;
        
        const buttonGroup = listHeader.querySelector('.flex.gap-4');
        buttonGroup.insertBefore(refreshBtn, buttonGroup.firstChild);
    }
}


        // Form Management
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize theme first
            initializeTheme();

            // Try to load from backend, fall back to demo data
            let backendLoaded = false; // Set to false initially
            // backendLoaded = await loadSLAsFromBackend();

            if (!backendLoaded) {
                console.log('Using demo data as fallback');
                // Initialize with demo data
                updateDashboardStats();
                updateDashboardRecentSLAs();
            }
            
            // Initialize demo data on page load
            updateDashboardStats();
            updateDashboardRecentSLAs();

            // Add initial SLA form
            addNewSLA();
            
            // Initialize tab title listeners
            attachTabTitleListeners();
                    
            // Handle form submission
            const createSlaForm = document.getElementById('createSlaForm');
            if (createSlaForm) {
                // Update your form submission handler
                // createSlaForm.addEventListener('submit', async function(e) {
                //     e.preventDefault();
                    
                //     const slaData = collectSLAData();
                    
                //     if (slaData.length === 0) {
                //         showNotification('Please create and save at least one SLA', 'error');
                //         return;
                //     }

                //     const payload = {
                //         timestamp: new Date().toISOString(),
                //         slaCount: slaData.length,
                //         slas: slaData
                //     };

                //     // Show JSON for demo (keep this)
                //     console.log('SLA Data to be sent to backend:', JSON.stringify(payload, null, 2));
                //     showJsonModal(payload);
                    
                //     // Actually submit to backend
                //     const success = await submitToBackend(payload);
                    
                //     if (success) {
                //         showNotification('All SLAs processed successfully!');
                //         setTimeout(() => {
                //             showSection('list');
                //         }, 2000);
                //     }
                // });


                // Modify the existing form submission handler
                createSlaForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    submitSLAs();
                });
            }

            // Add search and filter functionality
            const searchInput = document.getElementById('searchInput');
            const statusFilter = document.getElementById('statusFilter');
            const priorityFilter = document.getElementById('priorityFilter');

            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    showNotification('Search functionality would filter results here');
                });
            }

            if (statusFilter) {
                statusFilter.addEventListener('change', function() {
                    showNotification('Status filter applied');
                });
            }

            if (priorityFilter) {
                priorityFilter.addEventListener('change', function() {
                    showNotification('Priority filter applied');
                });
            }
        });

function cancelEdit() {
    if (isEditMode) {
        isEditMode = false;
        editingSlaId = null;
        
        // Reset header and button
        const header = document.querySelector('#create h2');
        const submitButton = document.querySelector('#create button[type="submit"]');
        if (header) header.textContent = 'Create SLAs';
        if (submitButton) submitButton.textContent = 'Create All SLAs';
        
        // Go back to list instead of detail since detail nav is removed
        showSection('list');
    } else {
        showSection('dashboard');
    }
}

// Add this function to handle backend submission
async function submitToBackend(payload) {
    const BACKEND_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
    
    try {
        const response = await fetch(BACKEND_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification(`Successfully saved ${result.data.processedCount} SLAs to Google Sheets!`);
            return true;
        } else {
            showNotification(`Error: ${result.message}`, 'error');
            return false;
        }
    } catch (error) {
        console.error('Backend submission error:', error);
        showNotification('Failed to save to backend. Check console for details.', 'error');
        return false;
    }
}


        // Show JSON Modal for demo purposes
        function showJsonModal(payload) {
            // Create and show modal with JSON data
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-surface rounded-lg p-6 w-full max-w-4xl mx-4 max-h-96 overflow-y-auto';
            
            modalContent.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-primary-color">JSON Payload (Ready for Backend)</h3>
                    <button class="close-modal text-secondary-color hover:text-primary-color">‚úï</button>
                </div>
                <pre class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto">${JSON.stringify(payload, null, 2)}</pre>
                <div class="flex justify-end space-x-3 mt-4">
                    <button class="copy-json px-4 py-2 rounded-md btn-secondary">Copy JSON</button>
                    <button class="close-modal px-4 py-2 rounded-md btn-primary">Close</button>
                </div>
            `;
            
            // Add secure event listeners instead of onclick
            modalContent.querySelector('.copy-json').addEventListener('click', () => {
                copyToClipboard(JSON.stringify(payload));
            });
            
            modalContent.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => modal.remove());
            });
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        // Theme Management
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const themeToggle = document.getElementById('themeToggle');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                if (themeToggle) themeToggle.checked = true;
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                if (themeToggle) themeToggle.checked = false;
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Show notification
            const themeText = newTheme === 'dark' ? 'Dark' : 'Light';
            showNotification(`${themeText} mode activated`);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('JSON copied to clipboard!');
            }).catch(() => {
                showNotification('Failed to copy JSON', 'error');
            });
        }

        // Initialize progress bar animations
        document.addEventListener('DOMContentLoaded', function() {
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });
            
            // Initialize tab title listeners
            attachTabTitleListeners();
        });
    </script>
</body>
</html>